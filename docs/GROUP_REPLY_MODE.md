# 群组简洁模式配置说明

## 📋 功能概述

支持为不同群聊设置独立的简洁模式，不同群聊可以有不同的回复风格。

---

## 🎯 功能说明

### 简洁模式类型

- **normal（正常）**：根据消息内容智能判断是否简洁
  - 包含问号（？或?）→ 简洁
  - 包含疑问词（怎么、如何、为什么）→ 简洁
  - 其他情况 → 正常回复

- **concise（简洁）**：全局简洁模式，所有回复都简短
  - 适合技术讨论群、高效沟通群
  - 回复限制在 `REPLY_MAX_LENGTH` 字符内

- **detailed（详细）**：全面解答，提供详细信息
  - 适合学习交流群、新手引导群
  - 提供完整的解释和示例

---

## 🔧 配置方式

### 全局默认配置

**位置：** `.env` 文件

```ini
# ========== 简洁模式配置 ==========
# 回复模式：normal（正常）/ concise（简洁）/ detailed（详细）
REPLY_MODE=normal

# 回复最大字符数（简洁模式下生效）
REPLY_MAX_LENGTH=500

# 简洁模式触发模式（正则表达式列表）
CONCISE_MODE_PATTERNS=["[？?]", "(怎么|如何|为什么)"]
```

### 群组配置

**位置：** `group_configs.json` 文件

**示例：**
```json
{
  "123456789": {
    "reply_mode_config": {
      "reply_mode": "concise"
    }
  },
  "987654321": {
    "reply_mode_config": {
      "reply_mode": "normal"
    }
  }
}
```

---

## 💬 管理员命令

### 查看配置

```
/reply_mode_status  # 查看简洁模式配置（可在群中查看当前群配置）
```

**输出示例：**
```
📝 简洁模式配置 💙

【全局默认配置】
• 回复模式：normal
  • normal - 正常模式（根据内容判断）
  • concise - 简洁模式（所有回复简短）
  • detailed - 详细模式（全面解答）
• 最大长度：500 字符

【当前群配置】
• 群号：123456789
• 回复模式：concise
⚠️ 已覆盖全局默认配置

【触发模式】
• [？?]
• (怎么|如何|为什么)

【说明】
• normal 模式下，以下情况自动使用简洁回复：
  - 包含问号（？或?）
  - 包含疑问词：怎么、如何、为什么
  - 匹配其他触发模式

💡 使用 /reply_mode_set <群号> <模式> 设置群简洁模式
💡 使用 /reply_mode_reset <群号> 恢复全局默认
```

---

### 设置群组配置

```
/reply_mode_set <群号> <模式>

# 示例：
/reply_mode_set 123456789 normal    # 设置为正常模式
/reply_mode_set 123456789 concise   # 设置为简洁模式
/reply_mode_set 123456789 detailed  # 设置为详细模式
```

**输出示例：**
```
✅ 已设置群 123456789 为 简洁模式（所有回复简短） ✨💙

• 群号：123456789
• 回复模式：concise - 简洁模式（所有回复简短）

✨ 已生效，群内回复将使用新设置
```

---

### 重置群组配置

```
/reply_mode_reset <群号>

# 示例：
/reply_mode_reset 123456789  # 恢复全局默认配置
```

**输出示例：**
```
✅ 已重置群 123456789 为全局默认配置 ✨💙

• 群号：123456789
• 回复模式：normal

✨ 已生效，群内回复将使用全局默认设置
```

---

### 查看所有群配置

```
/reply_mode_list  # 查看所有群的简洁模式配置
```

**输出示例：**
```
✨ 群组简洁模式配置列表 💙

全局默认：normal

【自定义配置的群】

群 123456789：简洁
群 987654321：详细

💡 提示：使用 /reply_mode_reset <群号> 恢复默认配置
```

---

## 🎯 使用场景

### 场景1：技术讨论群

**需求：** 快速回答技术问题，避免冗余

**推荐配置：**
```ini
# .env 全局配置
REPLY_MODE=concise
REPLY_MAX_LENGTH=300
```

**效果：** 所有回复都在 300 字符内，简洁高效

---

### 场景2：学习交流群

**需求：** 根据问题类型调整，简单问题简洁，复杂问题详细

**推荐配置：**
```ini
# .env 全局配置
REPLY_MODE=normal
REPLY_MAX_LENGTH=500
CONCISE_MODE_PATTERNS=["[？?]", "(怎么|如何|为什么)"]
```

**效果：**
- 问"怎么用 Git？" → 简洁回复（包含问号）
- 问"详细介绍一下 Git 的工作原理" → 详细回复（普通问题）

---

### 场景3：新手引导群

**需求：** 提供全面的解答和教程

**推荐配置：**
```
# 群组配置（通过命令设置）
/reply_mode_set 123456789 detailed
```

**效果：** 所有回复都详细全面，包含完整说明和示例

---

### 场景4：混合群聊

**需求：** 不同群使用不同模式

**配置示例：**
```json
{
  "123456789": {
    "reply_mode_config": {
      "reply_mode": "concise"
    }
  },
  "987654321": {
    "reply_mode_config": {
      "reply_mode": "normal"
    }
  },
  "111222333": {
    "reply_mode_config": {
      "reply_mode": "detailed"
    }
  }
}
```

**效果：**
- 群 123456789：简洁模式（技术群）
- 群 987654321：正常模式（日常群）
- 群 111222333：详细模式（学习群）

---

## 💡 配置优先级

### 优先级规则

1. **群组配置（最高）** - 如果群有自定义配置，优先使用
2. **全局配置（默认）** - 如果群未配置，使用全局默认

### 配置流程

```
用户在群中发送消息
    ↓
检查群组是否有自定义简洁模式配置？
    ├─ 有 → 使用群组配置
    └─ 没有 → 使用全局默认配置
    ↓
生成回复
```

---

## 📊 配置对比

| 场景 | 群组配置 | 全局配置 | 实际使用 | 说明 |
|------|----------|----------|----------|------|
| 群有配置 | concise | normal | **concise** | 优先使用群配置 |
| 群无配置 | - | normal | **normal** | 使用全局默认 |
| 群配置已重置 | - | detailed | **detailed** | 恢复全局默认 |

---

## 🎯 最佳实践

### 1. 按群用途设置

根据群的用途设置不同的简洁模式：
- 技术群 → concise（简洁）
- 日常群 → normal（正常）
- 学习群 → detailed（详细）

### 2. 定期检查配置

使用 `/reply_mode_list` 定期检查所有群的配置，确保符合预期。

### 3. 测试新配置

设置群配置后，发送测试消息，观察回复是否符合预期。

### 4. 文档记录

记录每个群的配置原因，方便后续调整。

---

## 📝 常见问题

### Q1：群配置会覆盖全局配置吗？

**A：** 是的。如果群有自定义配置，优先使用群配置，忽略全局配置。

---

### Q2：如何让所有群使用相同配置？

**A：** 不设置群组配置，所有群都使用全局默认配置。或者重置所有群配置。

---

### Q3：修改全局配置会影响已配置的群吗？

**A：** 不会。已配置的群继续使用群配置，未配置的群使用新的全局配置。

---

### Q4：如何批量重置所有群配置？

**A：** 可以删除 `group_configs.json` 文件中的 `reply_mode_config` 部分，或者使用 `/reply_mode_reset <群号>` 逐个重置。

---

### Q5：简洁模式和智能触发会冲突吗？

**A：** 不会。简洁模式控制回复长度，智能触发控制是否回复，两者独立工作。

---

## 🎉 总结

### 核心功能

1. ✅ **群组配置** - 不同群可以有不同的简洁模式
2. ✅ **全局默认** - 未配置的群使用全局默认
3. ✅ **灵活切换** - 管理员命令动态切换，无需重启
4. ✅ **优先级清晰** - 群配置 > 全局配置

### 推荐配置

**技术群：** `concise`（简洁）
**日常群：** `normal`（正常）
**学习群：** `detailed`（详细）

---

## 📚 相关文档

- [简洁模式说明](https://github.com/lridea/QQBot/blob/master/docs/CONCISE_MODE.md)
- [智能触发说明](https://github.com/lridea/QQBot/blob/master/docs/INTELLIGENT_TRIGGER.md)
- [配置文件说明](https://github.com/lridea/QQBot/blob/master/.env.example)

---

**文档版本：** 1.0.0
**最后更新：** 2026-02-16
