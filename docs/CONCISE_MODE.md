# 简洁回复模式功能文档

## 📋 功能概述

简洁回复模式允许机器人以更简短、高效的方式回复消息，减少冗余内容，提升沟通效率。

---

## 🎯 适用场景

- **技术问题**：快速回答"怎么做"、"如何解决"等问题
- **快速查询**：简短回答事实性问题
- **代码问题**：直接给出代码或解决方案
- **群聊环境**：避免刷屏，保持群聊清爽

---

## ⚙️ 配置说明

### 环境变量配置（.env 文件）

```ini
# ========== 简洁模式配置 ==========
# 回复模式：normal（正常）/ concise（简洁）/ detailed（详细）
REPLY_MODE=normal

# 回复最大字符数（简洁模式下生效）
REPLY_MAX_LENGTH=500

# 简洁模式触发模式（正则表达式列表）
# 匹配这些模式时自动使用简洁模式回复
CONCISE_MODE_PATTERNS=["[？?]", "(怎么|如何|为什么)"]
```

### 配置项说明

| 配置项 | 类型 | 可选值 | 默认值 | 说明 |
|--------|------|--------|--------|------|
| `REPLY_MODE` | string | `normal`/`concise`/`detailed` | `normal` | 全局回复模式 |
| `REPLY_MAX_LENGTH` | int | 任意正整数 | `500` | 简洁模式下的最大字符数 |
| `CONCISE_MODE_PATTERNS` | list | 正则表达式数组 | `["[？?]", "(怎么|如何|为什么)"]` | 简洁模式触发模式 |

---

## 🔧 回复模式说明

### 1. Normal 模式（正常）

**描述：** 默认模式，使用正常长度的回复。

**行为：**
- 使用完整的系统提示词
- 根据消息内容判断是否使用简洁模式
- 如果匹配简洁模式触发条件，自动切换到简洁模式

**适用：**
- 日常聊天
- 需要详细说明的场景
- 私聊场景

**示例：**
```
用户：怎么解决 Python 报错？
回复：诶~ 主人遇到 Python 报错了呢！让星野帮你看看~ 💙

星野来帮你分析一下~ 首先要检查错误提示是什么类型的错误，然后针对性地解决哦！

常见的情况有：
1. 语法错误（SyntaxError）- 检查代码语法是否正确
2. 缩进错误（IndentationError）- Python 对缩进很敏感呢
3. 名称错误（NameError）- 变量名拼写错误或未定义
4. 类型错误（TypeError）- 数据类型不匹配

主人可以把具体的错误信息发给星野看，星野会帮你详细解决的！✨
```

### 2. Concise 模式（简洁）

**描述：** 全局启用简洁模式，所有回复都简短高效。

**行为：**
- 使用简洁版系统提示词
- 所有回复都控制在 2-3 句话内
- 自动截断过长的回复

**适用：**
- 技术群
- 追求高效沟通的群
- 不喜欢长篇大论的场景

**示例：**
```
用户：怎么解决 Python 报错？
回复：检查错误提示，确认语法是否正确。或发具体错误给星野看~
```

### 3. Detailed 模式（详细）

**描述：** 详细模式，提供更全面的回答。

**行为：**
- 使用完整的系统提示词
- 提供详细的解释和示例
- 不触发简洁模式

**适用：**
- 学习群
- 需要深度学习的场景
- 新手引导场景

---

## 🎯 简洁模式触发逻辑

### 触发条件

在 `normal` 模式下，以下情况会自动使用简洁模式：

1. **全局配置为 concise**：`REPLY_MODE=concise`
2. **消息匹配触发模式**：消息包含以下任一模式：
   - 包含问号（？或?）
   - 包含疑问词：怎么、如何、为什么
   - 匹配自定义的正则表达式

### 判断流程

```
消息进入
    ↓
检查 REPLY_MODE 配置
    ├─ concise → 使用简洁模式
    ├─ detailed → 使用详细模式
    └─ normal → 继续检查
        ↓
    检查消息是否匹配 CONCISE_MODE_PATTERNS
        ├─ 匹配 → 使用简洁模式
        └─ 不匹配 → 使用正常模式
```

---

## 📝 简洁模式特点

### 回复原则

1. **简短直接**：控制在 2-3 句话内
2. **只答核心**：不展开细节，直击要点
3. **少用表情**：最多 1 个表情符号
4. **避免废话**：不客套、不凑字数
5. **信息密集**：字字珠玑，快速解决问题

### 回复格式

| 问题类型 | 回复格式 | 示例 |
|---------|---------|------|
| 简单问题 | 1 句话直接回答 | `抱歉，星野不能联网查天气呢~` |
| 复杂问题 | 2-3 句话分点说明 | `先检查语法，再看错误类型，最后修复问题~` |
| 代码问题 | 直接给出代码 | `git add . && git commit -m "msg"` |
| 无法回答 | 简洁说明原因 | `抱歉，这个超出了星野的能力范围~` |

### 对比示例

#### Normal 模式

```
用户：怎么用 Git？
回复：诶~ 主人想学 Git 呢！星野来帮你~ 💙

Git 是一个很厉害的版本控制系统哦！

基本使用步骤是：
1. `git init` - 初始化仓库
2. `git add .` - 添加所有文件
3. `git commit -m "提交信息"` - 提交更改
4. `git push` - 推送到远程仓库

主人还想了解 Git 的其他功能吗？比如分支管理、合并冲突解决等？星野都可以教主人哦！✨
```

#### Concise 模式

```
用户：怎么用 Git？
回复：`git init` 初始化，`git add .` 添加文件，`git commit -m "msg"` 提交，`git push` 推送~
```

---

## 🔍 自动截断功能

### 功能说明

当简洁模式的回复超过 `REPLY_MAX_LENGTH` 时，会自动截断。

### 截断规则

1. **优先在句子边界截断**：在句号、问号、感叹号处截断
2. **保留至少一半内容**：确保不会截掉太多重要信息
3. **添加省略号**：如果无法在句子边界截断，添加 `...` 表示截断

### 示例

```
原始回复：
这个功能可以让机器人更智能地回复消息，无需手动@机器人，可以大大提升用户体验，让大家更方便地使用机器人~

设置方法也很简单，只需要在配置文件中添加相关配置即可，非常方便呢~

最大长度：50 字符

截断后：
这个功能可以让机器人更智能地回复消息，无需手动@机器人...
```

---

## 🚀 使用建议

### 场景1：技术讨论群

```ini
# 推荐配置
REPLY_MODE=concise
REPLY_MAX_LENGTH=300
CONCISE_MODE_PATTERNS=["[？?]", "(怎么|如何|为什么|bug|报错|错误)"]
```

**效果：** 快速回答技术问题，避免刷屏

### 场景2：学习交流群

```ini
# 推荐配置
REPLY_MODE=normal
REPLY_MAX_LENGTH=800
CONCISE_MODE_PATTERNS=["[？?]", "(怎么|如何|为什么)"]
```

**效果：** 根据问题类型自动调整回复长度

### 场景3：闲聊娱乐群

```ini
# 推荐配置
REPLY_MODE=normal
REPLY_MAX_LENGTH=500
CONCISE_MODE_PATTERNS=[]
```

**效果：** 不触发简洁模式，保持轻松的聊天氛围

### 场景4：新手引导群

```ini
# 推荐配置
REPLY_MODE=detailed
REPLY_MAX_LENGTH=1000
CONCISE_MODE_PATTERNS=[]
```

**效果：** 详细解答问题，帮助新手学习

---

## ⚠️ 注意事项

1. **不要将最大长度设置得太小**
   - 建议 `REPLY_MAX_LENGTH` 最小为 100
   - 太小会导致回复不完整

2. **根据群组特点调整**
   - 技术群：建议使用 `concise` 模式
   - 学习群：建议使用 `normal` 或 `detailed` 模式

3. **合理设置触发模式**
   - 不要设置太宽泛的正则表达式
   - 避免所有消息都触发简洁模式

4. **重启后生效**
   - 修改配置后需要重启机器人
   - 使用 `bash start.sh` 重启

---

## 🔧 测试方法

### 测试简洁模式

1. 修改 `.env` 文件：

```ini
REPLY_MODE=concise
REPLY_MAX_LENGTH=200
```

2. 重启机器人：

```bash
bash start.sh
```

3. 在群中发送测试消息：

```
怎么用 Git？
这个问题怎么解决？
```

4. 验证回复是否简洁

### 测试自动触发

1. 设置为 normal 模式：

```ini
REPLY_MODE=normal
CONCISE_MODE_PATTERNS=["[？?]"]
```

2. 重启机器人

3. 发送测试消息：

```
# 应该触发简洁模式
这个问题怎么解决？

# 不应该触发简洁模式
今天天气不错
```

4. 验证回复长度是否符合预期

---

## 📊 性能影响

### 优势

- **节省 Token**：简洁模式减少 AI 输出长度
- **降低成本**：使用更少的 API 调用成本
- **提升效率**：快速回复，减少等待时间

### 劣势

- **信息可能不完整**：过于简洁可能遗漏细节
- **不够温暖**：减少了机器人的人情味

---

## 🔄 配置对比

| 场景 | REPLY_MODE | REPLY_MAX_LENGTH | CONCISE_MODE_PATTERNS |
|------|------------|------------------|----------------------|
| 技术群 | `concise` | `300` | `["[？?]", "(怎么|如何)"]` |
| 学习群 | `normal` | `800` | `["[？?]"]` |
| 闲聊群 | `normal` | `500` | `[]` |
| 新手群 | `detailed` | `1000` | `[]` |

---

## 📚 相关文档

- [智能触发功能](INTELLIGENT_TRIGGER.md)
- [多模型配置](MULTI_MODEL.md)
- [配置文件说明](../.env.example)

---

## 💡 最佳实践

1. **先测试，后部署**
   - 在测试群验证简洁模式效果
   - 确认不会影响用户体验

2. **根据反馈调整**
   - 收集用户对回复长度的反馈
   - 逐步优化配置

3. **保持灵活性**
   - 不要一成不变
   - 根据不同群组特点调整

4. **平衡简洁与详细**
   - 简洁不代表信息不足
   - 详细不代表冗余

---

**文档版本：1.0.0**
**最后更新：2026-02-16**
